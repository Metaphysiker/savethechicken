@using MauiBlazorWeb.Shared.Components.ComponentsImpl.Contacts
@using MauiBlazorWeb.Shared.Components.ComponentsImpl.Addresses
@using global::Shared.Dtos.DtosImpl
@code {
    [Parameter, EditorRequired]
    public FarmDto Model { get; set; } = new FarmDto();
}

<div>
    <label for="name">Name:</label>
    <InputText id="name" @bind-Value="Model.Name" class="form-control" />
    <ValidationMessage For="@(() => Model.Name)" />
</div>

<ContactForm Contact="Model.Contact" />
<AddressForm Address="Model.Address" />

<div>
    <label for="number-of-chickens">Number of Chickens:</label>
    <InputNumber id="number-of-chickens" @bind-Value="Model.NumberOfChickens" class="form-control" />
    <ValidationMessage For="@(() => Model.NumberOfChickens)" />
</div>

<div>
    <label for="size">Size</label>
    <InputText id="size" @bind-Value="Model.Size" class="form-control" />
    <ValidationMessage For="@(() => Model.Size)" />
</div>

<div>
    <label for="color">Color</label>
    <InputText id="color" @bind-Value="Model.Color" class="form-control" />
    <ValidationMessage For="@(() => Model.Color)" />
</div>

<div>
    <label for="dates-for-rescues">Dates For Rescues (comma separated YYYY-MM-DD):</label>
    <InputText id="dates-for-rescues" @bind-Value="DatesForRescuesString" @onchange="OnDatesForRescuesChanged" class="form-control" />
    <ValidationMessage For="@(() => Model.DatesForRescues)" />
</div>

<div>
    <label for="general-information">General Information:</label>
    <InputTextArea id="general-information" @bind-Value="Model.GeneralInformation" class="form-control" />
    <ValidationMessage For="@(() => Model.GeneralInformation)" />
</div>

@code {
    private string DatesForRescuesString
    {
        get => string.Join(',', Model.DatesForRescues.Select(d => d.ToString("yyyy-MM-dd")));
        set
        {
            Model.DatesForRescues = value.Split(',', StringSplitOptions.RemoveEmptyEntries)
                .Select(s => DateOnly.TryParse(s.Trim(), out var d) ? d : (DateOnly?)null)
                .Where(d => d.HasValue)
                .Select(d => d.Value)
                .ToList();
        }
    }

    private void OnDatesForRescuesChanged(ChangeEventArgs e)
    {
        DatesForRescuesString = e.Value?.ToString() ?? string.Empty;
    }
}
