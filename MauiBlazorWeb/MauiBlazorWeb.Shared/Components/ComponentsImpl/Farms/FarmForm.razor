@using MauiBlazorWeb.Shared.Components.ComponentsImpl.Contacts
@using MauiBlazorWeb.Shared.Components.ComponentsImpl.Addresses
@using global::Shared.Dtos.DtosImpl
@code {
    [Parameter, EditorRequired]
    public FarmDto Model { get; set; } = new FarmDto();
}

<MudTextField @bind-Value="Model.Name" Label="Name" Variant="Variant.Outlined" />
<ValidationMessage For="@(() => Model.Name)" />

<ContactForm Contact="Model.Contact" />
<AddressForm Address="Model.Address" />

<MudNumericField T="int" @bind-Value="Model.NumberOfChickens" Label="Number of Chickens" Variant="Variant.Outlined" />
<ValidationMessage For="@(() => Model.NumberOfChickens)" />

<MudTextField @bind-Value="Model.Size" Label="Size" Variant="Variant.Outlined" />
<ValidationMessage For="@(() => Model.Size)" />

<MudTextField @bind-Value="Model.Color" Label="Color" Variant="Variant.Outlined" />
<ValidationMessage For="@(() => Model.Color)" />

<MudTextField @bind-Value="DatesForRescuesString" Label="Dates For Rescues (comma separated YYYY-MM-DD)" Variant="Variant.Outlined" @onchange="OnDatesForRescuesChanged" />
<ValidationMessage For="@(() => Model.DatesForRescues)" />

<MudTextField @bind-Value="Model.GeneralInformation" Label="General Information" Variant="Variant.Outlined" Lines="3" />
<ValidationMessage For="@(() => Model.GeneralInformation)" />

@code {
    private string DatesForRescuesString
    {
        get => string.Join(',', Model.DatesForRescues.Select(d => d.ToString("yyyy-MM-dd")));
        set
        {
            Model.DatesForRescues = value.Split(',', StringSplitOptions.RemoveEmptyEntries)
                .Select(s => DateOnly.TryParse(s.Trim(), out var d) ? d : (DateOnly?)null)
                .Where(d => d.HasValue)
                .Select(d => d.Value)
                .ToList();
        }
    }

    private void OnDatesForRescuesChanged(ChangeEventArgs e)
    {
        DatesForRescuesString = e.Value?.ToString() ?? string.Empty;
    }
}
