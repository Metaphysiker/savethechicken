@using MauiBlazorWeb.Shared.Components.ComponentsImpl.Contacts
@using MauiBlazorWeb.Shared.Components.ComponentsImpl.Addresses
@using MauiBlazorWeb.Shared.Components.ComponentsImpl.SaveChickenActions
@using MauiBlazorWeb.Shared.Components.MultiDateSelecters
@using MauiBlazorWeb.Shared.Resources.Strings
@using Microsoft.Extensions.Localization
@using MudBlazor
@using global::Shared.Dtos.DtosImpl
@inject IStringLocalizer<AppResources> L

@code {
    [Parameter, EditorRequired]
    public SaveChickenRequestDto Model { get; set; } = new SaveChickenRequestDto();

    [Parameter]
    public bool ShowSaveChickenActionInput { get; set; } = true;

    private List<int> saveChickenActionIds = new List<int>();

    protected override void OnInitialized()
    {
        saveChickenActionIds = Enumerable.Range(1, 10).ToList();
    }

    IList<IBrowserFile> files = new List<IBrowserFile>();
    private void UploadFiles(IReadOnlyList<IBrowserFile> files)
    {
        foreach (var file in files)
        {
            this.files.Add(file);
        }
        //TODO upload the files to the server
    }
}

<ContactForm Contact="Model.Contact" />
<AddressForm Address="Model.Address" />

<MudPaper Class="pa-4 my-4">
    <MudText Typo="Typo.h6">Allgemeine Informationen</MudText>
    <MudItem>
        <MudNumericField T="int" @bind-Value="Model.NumberOfChickensToBeSaved" Label="@L["NumberOfChickens"]" Variant="Variant.Outlined" />
        <ValidationMessage For="@(() => Model.NumberOfChickensToBeSaved)" />
    </MudItem>
    <MudItem>
        <MudTextField @bind-Value="Model.DescriptionOfPlaceForChickens" Label="@L["Description"]" Variant="Variant.Outlined" Lines="3" />
        <ValidationMessage For="@(() => Model.DescriptionOfPlaceForChickens)" />
    </MudItem>

    <MudItem>
        <MudTextField @bind-Value="Model.Message" Label="@L["Message"]" Variant="Variant.Outlined" Lines="3" />
        <ValidationMessage For="@(() => Model.Message)" />
    </MudItem>
    @if (ShowSaveChickenActionInput){
        <MudItem>
            <SaveChickenActionSelector @bind-SelectedActionId="Model.SaveChickenActionId" />
        </MudItem>
    }

    <MudItem>
        <MudCheckBox @bind-Value="Model.AcceptTermsAndConditions" Label="@L["AcceptTermsAndConditions"]"></MudCheckBox>
        <ValidationMessage For="@(() => Model.AcceptTermsAndConditions)" />
    </MudItem>

    <MudItem>
        <MudFileUpload T="IReadOnlyList<IBrowserFile>" FilesChanged="UploadFiles">
            <ActivatorContent>
                <MudButton Variant="Variant.Filled"
                        Color="Color.Primary"
                        StartIcon="@Icons.Material.Filled.CloudUpload">
                    Multiple Files
                </MudButton>
            </ActivatorContent>
        </MudFileUpload>

        @if (files != null)
        {
            <MudList T="string">
                @foreach (var file in files)
                {
                    <MudListItem Icon="@Icons.Material.Filled.AttachFile">
                        @file.Name <code>@file.Size bytes</code>
                    </MudListItem>
                }
            </MudList>
        }
    </MudItem>

</MudPaper>

<MultiDateOnlySelector @bind-SelectedDates="Model.DateForHandOver" Text="Ich bin an diesen Tagen erreichbar:" />
