@using MauiBlazorWeb.Shared.Factories.FactoriesImpl
@using MauiBlazorWeb.Web.Services.ServicesImpl
@using global::Shared.Dtos.DtosImpl
@typeparam TDto where TDto : class
@inject GenericDtoServiceFactory DtoServiceFactory

<EditForm Model="Model" OnValidSubmit="HandleValidSubmit">
    <DataAnnotationsValidator />
    <ValidationSummary />

    @ChildContent(Model)

    <button type="submit" class="btn btn-primary">Create</button>
</EditForm>

@code {
    [Parameter] public TDto Model { get; set; } = Activator.CreateInstance<TDto>();
    [Parameter] public RenderFragment<TDto> ChildContent { get; set; } = default!;

    private GenericDtoService<TDto, ISearchDto>? _service;

    protected override void OnInitialized()
    {
        _service = DtoServiceFactory.Create<TDto, ISearchDto>();
    }

    private async Task HandleValidSubmit()
    {
        if (_service != null)
        {
            await _service.CreateAsync(Model);
        }
    }
}
